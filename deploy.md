# Python 项目部署实战和我学到的东西

# 部署策略

- 蓝绿部署与滚动更新
- 手动部署
- 自动化

【TODO： 说说都有哪些部署策略，然后分步骤详细讲解】

## 部署策略1：蓝绿部署与滚动更新

蓝绿部署 (Blue/Green Deployment) 和滚动更新 (Rolling Update) 是实现服务升级（尤其是无感知/零停机升级）的两种主流策略。它们各有优劣，适用于不同的场景。

### 1. 蓝绿部署 (Blue/Green Deployment)

* **核心机制:**
    1. **环境准备:** 维护两个完全相同的生产环境，"蓝色 (Blue)" 和 "绿色 (Green)"。
    2. **流量导向:** 只有一个环境是活跃的（接收实时生产流量），假设当前是蓝色。
    3. **部署新版本:** 将新版本的代码部署到**绿色**环境。
    4. **测试绿色环境:** 在绿色环境上进行全面的测试。
    5. **切换流量:** 通过负载均衡器或反向代理，**瞬间**将所有生产流量从蓝色环境切换到绿色环境。
    6. **绿色变蓝色:** 绿色环境成为新的活跃生产环境。
    7. **保留旧环境:** 旧的蓝色环境保持运行一段时间，作为快速回滚的备用方案。
    8. **更新/停用旧环境:** 确认新版本稳定后，更新或停用旧的蓝色环境。

* **优点:**
  * 近乎零停机部署。
  * 即时回滚简单快速。
  * 风险较低（切换前充分测试）。
  * 环境隔离。

* **缺点:**
  * 资源成本高（接近双倍）。
  * 数据库兼容性挑战大。
  * 状态管理复杂。
  * 需要完整的环境和充分的测试。

* **业界最佳实践 & 考虑因素:**
  * 基础设施即代码 (IaC)。
  * 数据库迁移策略（兼容性变更优先）。
  * 成熟的流量切换机制（如 Caddy API）。
  * 自动化测试套件。
  * 切换后密切监控。

### 2. 滚动更新 (Rolling Update)

* **核心机制:**
    1. **实例池:** 生产环境由多个运行相同旧版本代码的实例组成。
    2. **逐步替换:** 逐步地用运行新版本代码的实例替换旧版本的实例。
    3. **过程:**
        * 启动少量新版本实例。
        * 等待健康检查通过。
        * 将新实例加入负载均衡器。
        * 从负载均衡器移除少量旧版本实例。
        * 等待连接耗尽。
        * 停止旧实例。
        * 重复直至所有实例更新。

* **优点:**
  * 资源高效。
  * 逐步上线，限制风险范围。
  * 通常零停机（需配置得当）。

* **缺点:**
  * 部署时间较长。
  * 回滚相对复杂且慢。
  * 部署期间新旧版本共存，对兼容性要求高（API、数据库、会话）。
  * 难以进行隔离的最终测试。
  * 可能短暂降低总服务容量。

* **业界最佳实践 & 考虑因素:**
  * 自动化和容器编排平台 (Kubernetes, ECS)。
  * 精细准确的健康检查 (Liveness, Readiness)。
  * 配置合理的更新参数（控制批次大小和速率）。
  * 保证 API 和数据库兼容性。
  * 设计与版本无关的会话管理。
  * 全程监控，快速响应问题。
  * 结合 Canary 发布（先更新极少数实例观察）。

### 总结与选择建议

* **没有绝对的"最佳":** 根据需求、风险、预算和应用特性选择。
* **蓝绿部署:** 适合停机敏感、预算充足、回滚要求高的场景。
* **滚动更新:** 适合实例众多、成本敏感、能保证兼容性的场景，是容器编排平台的常见选择。
* **Canary 发布:** 几乎总是推荐结合使用，以最小化风险。
* **基础:** 自动化 (CI/CD)、测试、监控、数据库和状态管理是成功的关键。

## 部署策略2：【TODO】

## 部署策略3: [todo]

## 如何为本项目选择合适的策略
【TODO： 我们的目标是快速完成部署，不用太考虑后续的升级维护，因为是实验性质，更重要的完成上线任务】所以为什么选择本地 Docker 部署

## Docker 部署的步骤和我们遇到的问题
【TODO】

## 如何维护我们的服务

【TODO】